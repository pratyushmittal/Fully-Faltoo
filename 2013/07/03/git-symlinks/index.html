<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}">
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Pratyush Mittal">
    <title>Relative symlinks in Git using subtree
    </title>    <link href="http://feeds.feedburner.com/fullyfaltoo" type="application/rss+xml" rel="alternate" title="A Fully-Faltoo Blog RSS Feed">    <link rel="shortcut icon" href="/favicon.ico">
    <link href="/favicon.ico" type="image/x-icon" rel="icon">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="/theme/css/css.css"><link rel="stylesheet" type="text/css" href="/theme/css/code.css"/>  </head>
  <body>
    <div class="wrapper">
      <div class="section intro right">
        <div class="navigation">
          <ul>            <li><a href="http://twitter.com/faltoo">@faltoo</a>
            </li>            <li class="active"><a href="/">Diary</a>
            </li>
            <li class=""><a href="/archives.html">Archives</a>
            </li>            <li class=""><a href="http://fully-faltoo.com/pages/poke.html">Poke Me!</a>
            </li>          </ul>
        </div>
        <div class="fix">
        </div>
      </div>
      <div class="sidebar logo left">
        <div class="logo center"><a href="/"><img src="/theme/images/logo100.png" alt="Pratyush - A <GeeK>!!!"></a>
        </div>
      </div>
      <div class="section main right">
        <div class="white"><article class="entry">
  <div class="page-header">
    <h1>Relative symlinks in Git using subtree
    </h1>
    <p class="meta sub"><a href="2013/07/03/git-symlinks/"><small>Wed 03 July 2013</small></a>
    </p>
  </div>
  <div class="page-content">
    <div class="post"><p>I have two separate projects and both use a common set of directories. Since both the projects are under active development, I symlinked the common files. Thus the changes were incorporated in both the projects. <strong>However, git <em>does not</em> follow the symbolic links and instead saves its contents.</strong></p>
<p>To solve it I:</p>
<ol>
<li>Copied one of the projects into the another as a subdirectory using subtree.</li>
<li>Created symlinks from inside this subtree directory.</li>
<li>Changed the absolute paths of symbolic links into relative paths.</li>
<li>Automated all of the above into a script.</li>
</ol>
<h2>Detailed steps</h2>
<p><strong>Step 1:</strong> Subtree is useful (and better than submodule) for including a project into another project as a subdirectory. The main advantage is that the changes are both downstream as well as upstream. I followed <a href="http://www.codeproject.com/Articles/562950/GitplusSubtreeplusMergeplus-e2-80-93TheplusQuickpl">this post</a> to include the project as subtree sub-directory.</p>
<p><strong>Step 2:</strong> Next step was to convert all the old symlinks (directly from main project) to symlinks from the new subtree directory. To find all the symbolic links in a directory use <code>$ find /path -type l</code>.</p>
<p><strong>Step 3:</strong> The symlinks created usually contain absolute file paths (even though they might be in the same git project). Use the <a href="http://bashscripts.org/forum/viewtopic.php?f=8&amp;t=457">symlinks utility</a> to convert all the symlinks from absolute paths to relative paths.</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install symlinks
<span class="nv">$ </span>symlinks -tscr .  <span class="c"># Preview changes</span>
<span class="nv">$ </span>symlinks -scr .   <span class="c"># Execute changes</span>
</pre></div>


<p><strong>Step 4:</strong> To automate all of the above, I compiled and saved the above commands in a fab file to run while committing the changes.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">sync_down</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Syncs downstream from remote to local branch&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git checkout remote_branch&quot;</span><span class="p">)</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git pull&quot;</span><span class="p">)</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git checkout master&quot;</span><span class="p">)</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&#39;git merge --squash -s subtree &#39;</span>
          <span class="s">&#39;--no-commit &#39;</span>
          <span class="s">&#39;remote_branch&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">sync_up</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Syncs upstream from local to remote branch&quot;&quot;&quot;</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git checkout remote_branch&quot;</span><span class="p">)</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&#39;git merge --squash -s subtree &#39;</span>
          <span class="s">&#39;--no-commit &#39;</span>
          <span class="s">&#39;master&#39;</span><span class="p">)</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&#39;git add . -A&#39;</span><span class="p">)</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&#39;git commit -m &quot;Merged changes from remote&quot;&#39;</span><span class="p">)</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git push remote remote_branch:master&quot;</span><span class="p">)</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;git checkout master&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">sync_all</span><span class="p">():</span>
    <span class="n">local</span><span class="p">(</span><span class="s">&quot;symlinks -scr .&quot;</span><span class="p">)</span>
    <span class="n">sync_down</span><span class="p">()</span>
    <span class="n">sync_up</span><span class="p">()</span>
</pre></div>


<p>I agree that this is a very hacky way to achieve a simple following of symlinks. I hope that someday git will provide an option of following symlinks (maybe through some toggle options in git configurations).</p>
    </div>
  </div>
</article><hr/><div class="comments">
  <h3>Add comment or 
<a href="https://twitter.com/share" data-via="faltoo" class="twitter-share-button">Tweet it</a>
  </h3>
  <div id="disqus_thread">
  </div>
  <script>var disqus_identifier = "2013/07/03/git-symlinks/";
var disqus_url = "http://fully-faltoo.com/2013/07/03/git-symlinks/";
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = 'http://fully-faltoo.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();

  </script>
</div>        </div>
        <div class="section footer right">
        </div>
      </div>
      <div class="sidebar left">
        <div class="white"><img src="http://dl.dropbox.com/u/4607238/profile.jpg">
          <h3>About Me
          </h3>
          <p class="sub">My name is Pratyush Mittal. I am a Chartered Accountant living in Lucknow, India. I love to create financial web-applications and write Python programs. I blog about stocks at <a href='http://dalal-street.in'>Dalal-Street</a>.

          </p>
        </div>
        <div class="white island"><gcse:search></gcse:search><a href="http://feedburner.google.com/fb/a/mailverify?uri=fullyfaltoo" target="_blank" class="no-line"><img src="/theme/images/email.gif"> Get updates via Email
</a><a href="http://feeds.feedburner.com/fullyfaltoo" class="right no-line"><img src="/theme/images/rss.png"> RSS Link
</a>
          <div class="fix">
          </div>
        </div>
        <div class="white island blogroll">
          <h3>Blogroll
          </h3>          <p><a href="http://news.ycombinator.com/">Hacker News</a><small class="sub">: To keep updated with the latest tech developments</small>
          </p>          <p><a href="http://lifehacker.com">LifeHacker</a><small class="sub">: Collection of the best life hacks</small>
          </p>          <p><a href="http://www.screener.in">Screener.in</a><small class="sub">: A Stock Screener and stock analysis tool I am working on</small>
          </p>          <p><a href="http://www.webtrickz.com">WebTrickz</a><small class="sub">: My cousin Mayur's Blog for the best 'web-tricks'</small>
          </p>        </div>
        <footer class="white island">
          <p><small>Designed with &lt;3 in India.
</small>
          </p>
          <p><small>Proudly powered by 
<a href="http://getpelican.com/">Pelican</a>, and hosted on 
<a href="http://python.org">GitHub</a>.
</small>
          </p>
        </footer>
      </div>
      <div class="fix">
      </div>
    </div>    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2456523-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'fully-faltoo';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script>
  (function() {
    var cx = '009049710563382089934:sftcdudo044';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script><script>// Put this just before the closing body tag
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

</script>  </body>
</html>